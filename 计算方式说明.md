# 易经六爻算法计算方式详解

## 一、基础数据体系

### 1.1 天干地支系统

天干（10个）：甲、乙、丙、丁、戊、己、庚、辛、壬、癸 

地支（12个）：子、丑、寅、卯、辰、巳、午、未、申、酉、戌、亥

地支与数字对应关系：

子=1, 丑=2, 寅=3, 卯=4, 辰=5, 巳=6
午=7, 未=8, 申=9, 酉=10, 戌=11, 亥=12

### 1.2 八卦系统

八卦与数字对应关系：

乾=1, 兑=2, 离=3, 震=4, 巽=5, 坎=6, 艮=7, 坤=8
八卦符号表示：

| 乾   | ☰           |
| 兑   | ☱           |
| 离   | ☲           |
| 震   | ☳           |
| 巽   | ☴           |
| 坎   | ☵           |
| 艮   | ☶           |
| 坤   | ☷           |

### 1.3 五行系统

五行属性：金、木、水、火、土

#### 八卦五行归属：

金：乾、兑
木：震、巽
水：坎
火：离
土：艮、坤

#### 地支五行归属：

金：申、酉
木：寅、卯
水：子、亥
火：巳、午
土：辰、戌、丑、未

#### 五行生克关系：

相生：金生水、水生木、木生火、火生土、土生金
相克：金克木、木克土、土克水、水克火、火克金

## 二、时间起卦计算方法

### 2.1 农历日期获取

优先使用农历：获取农历年、月、日 公历备用：当农历计算失败时，使用公历年、月、日

### 2.2 年地支计算公式

公式：年地支索引 = (农历年 - 4) % 12 

### 2.3 时辰地支计算

时辰对应表：

23-0时：子时
1-2时：丑时
3-4时：寅时
5-6时：卯时
7-8时：辰时
9-10时：巳时
11-12时：午时
13-14时：未时
15-16时：申时
17-18时：酉时
19-20时：戌时
21-22时：亥时

### 2.4 上卦计算公式

公式：上卦序号 = (年数 + 月数 + 日数) % 8 特殊处理：如果余数为0，则取8 结果：通过序号在八卦映射表中查找对应八卦

### 2.5 下卦计算公式

公式：下卦序号 = (年数 + 月数 + 日数 + 时数) % 8 特殊处理：如果余数为0，则取8 结果：通过序号在八卦映射表中查找对应八卦

### 2.6 动爻计算公式

公式：动爻位置 = (年数 + 月数 + 日数 + 时数) % 6 特殊处理：如果余数为0，则取6 结果：得到第几爻为动爻（1-6）

## 三、铜钱起卦计算方法

### 3.1 铜钱投掷规则

每爻投掷：投掷3枚铜钱 面值定义：阳面（正面）、阴面（背面） 总计6次：从第1爻到第6爻依次投掷

### 3.2 爻性判断公式

根据阴面数量判断：

0个阴面（3个阳面）→ 老阴（动爻）━ ━ ❌
1个阴面（2个阳面）→ 少阳（静爻）━━━
2个阴面（1个阳面）→ 少阴（静爻）━ ━
3个阴面（0个阳面）→ 老阳（动爻）━━━ ⭕

### 3.3 卦象构建方法

爻位排列：第1爻在最下，第6爻在最上 上卦构成：第4、5、6爻（从下往上数） 下卦构成：第1、2、3爻（从下往上数） 八卦识别：根据三爻的阴阳组合查找对应八卦

### 3.4 动爻标记

动爻条件：老阳或老阴 静爻条件：少阳或少阴 动爻作用：用于计算变卦

## 四、数字起卦计算方法

### 4.1 数字验证规则

数字范围：每个数字必须在1-10之间 数字数量：支持2个或3个数字 模式判断：自动根据数字数量确定模式

### 4.2 上卦计算公式

公式：上卦序号 = 第一个数字 % 8 特殊处理：如果余数为0，则取8 结果：通过序号查找对应八卦

### 4.3 下卦计算公式

公式：下卦序号 = 第二个数字 % 8 特殊处理：如果余数为0，则取8 结果：通过序号查找对应八卦

### 4.4 动爻计算公式

三数字模式：动爻位置 = 第三个数字 % 6 两数字模式：动爻位置 = (第一个数字 + 第二个数字) % 6 特殊处理：如果余数为0，则取6 结果：确定第几爻为动爻

## 五、六亲计算原理

### 5.1 本宫五行确定

#### 5.1.1 卦宫归属规则

六十四卦按八宫分类，每宫八卦，共八宫：

**乾宫（金）**：乾为天、天风姤、天山遁、天地否、风地观、山地剥、火地晋、火天大有
**坤宫（土）**：坤为地、地雷复、地泽临、地天泰、雷天大壮、泽天夬、水天需、水地比
**震宫（木）**：震为雷、雷地豫、雷水解、雷风恒、地风升、水风井、泽风大过、泽雷随
**巽宫（木）**：巽为风、风天小畜、风火家人、风雷益、天雷无妄、火雷噬嗑、山雷颐、山风蛊
**坎宫（水）**：坎为水、水泽节、水雷屯、水火既济、泽火革、雷火丰、地火明夷、地水师
**离宫（火）**：离为火、火山旅、火风鼎、火水未济、山水蒙、风水涣、天水讼、天火同人
**艮宫（土）**：艮为山、山火贲、山天大畜、山泽损、火泽睽、天泽履、风泽中孚、风山渐
**兑宫（金）**：兑为泽、泽水困、泽地萃、泽山咸、水山蹇、地山谦、雷山小过、雷泽归妹

#### 5.1.2 本宫五行确定步骤

1. **确定卦名**：根据上卦和下卦的组合，查找对应的卦名
   - 例如：上卦为乾（☰），下卦为坤（☷），组合为天地否卦

2. **查找宫位归属**：通过卦宫映射表确定该卦属于哪一宫
   - 例如：天地否卦属于乾宫

3. **获取本宫五行**：每个宫位都有固定的五行属性
   - 乾宫、兑宫 → 金
   - 震宫、巽宫 → 木  
   - 坎宫 → 水
   - 离宫 → 火
   - 坤宫、艮宫 → 土

#### 5.1.3 实际计算示例

假设得到水火既济卦：
- 上卦：坎（☵）
- 下卦：离（☲）
- 卦名：水火既济
- 宫位归属：坎宫
- 本宫五行：水

### 5.2 爻的五行获取

#### 5.2.1 纳甲地支配置详解

每个八卦都有固定的地支配置，从第1爻到第6爻依次对应：

**乾卦纳甲**：子、寅、辰、午、申、戌
**坤卦纳甲**：未、巳、卯、丑、亥、酉
**震卦纳甲**：子、寅、辰、午、申、戌
**巽卦纳甲**：丑、亥、酉、未、巳、卯
**坎卦纳甲**：寅、辰、午、申、戌、子
**离卦纳甲**：卯、丑、亥、酉、未、巳
**艮卦纳甲**：辰、午、申、戌、子、寅
**兑卦纳甲**：巳、卯、丑、亥、酉、未

#### 5.2.2 六爻地支组合规则

六爻卦的地支配置方法：
- **第1、2、3爻**：使用下卦对应的前3个地支
- **第4、5、6爻**：使用上卦对应的后3个地支

#### 5.2.3 地支五行对应表

**金**：申（阳金）、酉（阴金）
**木**：寅（阳木）、卯（阴木）
**水**：子（阳水）、亥（阴水）
**火**：巳（阴火）、午（阳火）
**土**：辰（阳土）、戌（阳土）、丑（阴土）、未（阴土）

#### 5.2.5 爻的五行获取步骤总结

1. **确定上下卦**：分别识别第4-6爻组成的上卦和第1-3爻组成的下卦
2. **查找纳甲地支**：根据八卦纳甲表，获取上卦和下卦各自的地支序列
3. **组合六爻地支**：下卦前3个地支 + 上卦后3个地支
4. **转换为五行**：通过地支五行对应表，将每个地支转换为对应的五行属性
5. **完成配置**：得到六爻各自的五行属性，用于后续六亲关系计算

### 5.3 六亲关系计算公式

生克关系判断：

本宫五行 = 爻五行 → 兄弟
本宫五行 生 爻五行 → 子孙
本宫五行 克 爻五行 → 妻财
爻五行 生 本宫五行 → 父母
爻五行 克 本宫五行 → 官鬼

## 六、六神配置原理

### 6.1 日干获取方法

自动计算公式：

```bash
处理1、2月：年份 - 1，月份+12  

C = 年份 ÷ 100（取整）

y = 年份 % 100

g = 4C + [C/4] + 5y + [y/4] + [3(M+1)/5] + 日 - 3

天干序号 = g % 10（余数为0时取10）
```

### 6.2 六神配置表

按日干配置：

甲乙日：青龙、朱雀、勾陈、螣蛇、白虎、玄武
丙丁日：朱雀、勾陈、螣蛇、白虎、玄武、青龙
戊日：勾陈、螣蛇、白虎、玄武、青龙、朱雀
己日：螣蛇、白虎、玄武、青龙、朱雀、勾陈
庚辛日：白虎、玄武、青龙、朱雀、勾陈、螣蛇
壬癸日：玄武、青龙、朱雀、勾陈、螣蛇、白虎

### 6.3 六神排列顺序

配置顺序：从第1爻到第6爻依次配置 显示顺序：从第6爻到第1爻显示（与传统习惯一致）

## 七、纳甲地支系统

### 7.1 八卦纳甲表

各卦地支配置（从第1爻到第6爻）：

乾卦：子、寅、辰、午、申、戌
坤卦：未、巳、卯、丑、亥、酉
震卦：子、寅、辰、午、申、戌
巽卦：丑、亥、酉、未、巳、卯
坎卦：寅、辰、午、申、戌、子
离卦：卯、丑、亥、酉、未、巳
艮卦：辰、午、申、戌、子、寅
兑卦：巳、卯、丑、亥、酉、未

### 7.2 六爻地支组合规则

组合方式：下卦地支（前3个）+ 上卦地支（后3个） 对应关系：

第1、2、3爻：使用下卦的前3个地支
第4、5、6爻：使用上卦的后3个地支

### 7.3 世应位置确定

固定规律：世应位置相隔3个爻位 查表方式：通过完整的六十四卦世应位置表直接查找 位置范围：世爻和应爻都在1-6爻范围内

## 八、变卦计算原理

### 8.1 时间起卦和数字起卦变卦

变化规则：只有动爻位置发生变化 变化方式：

阳爻（━━━）变为阴爻（━ ━）
阴爻（━ ━）变为阳爻（━━━） 重新分析：变化后重新确定上下卦和卦名

### 8.2 铜钱起卦变卦

多动爻处理：所有动爻位置都发生变化 变化规则：与时间起卦相同 静爻保持：非动爻位置保持不变

### 8.3 变卦构建步骤

1.识别所有动爻位置
2.将动爻进行阴阳转换
3.重新分析上卦（第4、5、6爻）
4.重新分析下卦（第1、2、3爻）
5.查找新的卦名

## 九、算法整体流程

### 9.1 起卦阶段

1.根据起卦方式获取基础数据
2.计算上卦和下卦
3.确定动爻位置
4.查找卦名

### 9.2 分析阶段

1.获取世应位置
2.计算纳甲地支
3.确定六亲关系
4.配置六神
5.计算变卦

### 9.3 输出阶段

1.构建完整的六爻信息
2.标记动爻和世应
3.生成分析结果